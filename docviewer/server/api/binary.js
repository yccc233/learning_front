const router = require("express").Router();
var multiparty = require('multiparty');
var Blob = require('blob');
var fs = require("fs");
var path = require("path");
var http = require("http");

var fileStream;
var fileName;
var fileType;

var stream = `ʱ��,ʱ��,��/��,��ʽ,���ݲɼ�Դ,��ע
2021/11/24 19:55,����,��,����,С��,1��
2021/11/25 7:46,����,��,����,С��,1��
2021/11/25 10:20,����,��,����,С��,1��
2021/11/25 15:58,����,��,����,С��,1��
2021/11/25 19:00,����,��,����,С��,1��
2021/11/26 7:44,����,��,����,С��,1��
2021/11/26 19:00,����,��,����,С��,1��
2021/11/26 19:30,����,��,����,С��,4��
2021/11/26 21:20,����,��,����,С��,4��
2021/11/26 22:55,����,��,����,С��,2��
2021/11/26 23:30,����,��,����,С��,2��
2021/11/27 11:30,����,��,����,С��,1��
2021/11/27 12:42,����,��,����,С��,1��
2021/11/27 13:32,����,��,����,С��,4��
2021/11/27 14:32,����,��,����,С��,1��
2021/11/27 15:50,����,��,����,С��,1��
2021/11/27 17:20,����,��,����,С��,2��
2021/11/27 23:35,����,��,����,С��,2��
2021/11/28 13:21,����,��,����,С��,4��
2021/11/28 15:26,����,��,����,С��,4��
2021/11/28 20:57,����,��,����,С��,4��
2021/11/29 7:55,��һ,��,����,С��,1��
2021/11/29 9:25,��һ,��,����,С��,1��
2021/11/29 13:21,��һ,��,����,С��,1��
2021/11/29 13:52,��һ,��,����,С��,1��
2021/11/29 15:56,��һ,��,����,С��,1��
2021/11/29 19:30,��һ,��,����,С��,1��
2021/11/30 10:20,�ܶ�,��,����,С��,1��
2021/11/30 16:25,�ܶ�,��,����,С��,1��
2021/11/30 19:16,�ܶ�,��,����,С��,1��
2021/12/1 7:45,����,��,����,С��,1��
2021/12/1 11:00,����,��,����,С��,1��
2021/12/1 15:50,����,��,����,С��,1��
2021/12/1 16:45,����,��,����,С��,1��
2021/12/1 19:46,����,��,����,С��,1��
2021/12/2 8:00,����,��,����,С��,1��
2021/12/2 11:00,����,��,����,С��,1��
2021/12/2 16:15,����,��,����,С��,1��
2021/12/2 19:40,����,��,����,С��,1��
2021/12/3 8:05,����,��,����,С��,1��
2021/12/3 12:35,����,��,����,С��,1��
2021/12/4 7:55,����,��,����,С��,1��
2021/12/4 10:55,����,��,����,С��,1��
2021/12/4 13:40,����,��,����,С��,4��
2021/12/4 14:55,����,��,����,С��,4��
2021/12/5 12:45,����,��,����,С��,1��
2021/12/5 13:05,����,��,����,С��,1��
2021/12/6 12:10,��һ,��,����,С��,1��
2021/12/7 11:05,�ܶ�,��,����,С��,1��
2021/12/7 15:35,�ܶ�,��,����,С��,1��
2021/12/8 22:30,����,��,����,С��,1��
2021/12/9 0:42,����,��,����,С��,1��
2021/12/10 8:00,����,��,����,С��,1��
2021/12/10 15:45,����,��,����,С��,1��
2021/12/10 20:10,����,��,����,С��,1��
2021/12/13 7:55,��һ,��,����,С��,1��
2021/12/13 10:07,��һ,��,����,С��,1��
2021/12/13 12:30,��һ,��,����,С��,1��
2021/12/13 14:05,��һ,��,����,С��,1��
2021/12/14 7:55,�ܶ�,��,����,С��,1��
2021/12/15 7:50,����,��,����,С��,1��
2021/12/15 17:35,����,��,����,С��,1��
2021/12/16 7:43,����,��,��,С��,2��
2021/12/16 11:02,����,��,����,С��,1��
2021/12/16 17:00,����,��,����,С��,1��
2021/12/16 21:05,����,��,����,С��,1��
2021/12/17 9:00,����,��,����,С��,1��
2021/12/17 11:02,����,��,����,С��,1��
2021/12/17 15:24,����,��,����,С��,1��
2021/12/17 18:55,����,��,����,С��,1��
2021/12/18 9:40,����,��,����,С��,1��
2021/12/18 10:21,����,��,����,С��,1��
2021/12/19 11:15,����,��,����,С��,4��
2021/12/20 7:45,��һ,��,����,С��,1��
2021/12/20 10:42,��һ,��,����,С��,1��
2021/12/20 16:10,��һ,��,����,С��,1��
2021/12/20 19:50,��һ,��,����,С��,1��
2021/12/21 9:55,�ܶ�,��,����,С��,1��
2021/12/21 14:46,�ܶ�,��,����,С��,1��
2021/12/21 15:46,�ܶ�,��,����,С��,1��
2021/12/21 16:02,�ܶ�,��,����,С��,1��
2021/12/22 7:55,����,��,����,С��,1��
2021/12/22 10:35,����,��,�ﳵ,С��,1��
2021/12/22 15:35,����,��,����,С��,1��
2021/12/23 7:45,����,��,��,С��,2��
2021/12/23 11:16,����,��,�ﳵ,С��,1��
2021/12/24 10:00,����,��,����,С��,1��
2021/12/24 15:52,����,��,����,С��,1��
2021/12/24 20:30,����,��,����,С��,1��
2021/12/24 20:40,����,��,����,С��,1��
2021/12/26 18:45,����,��,����,С��,1��
2021/12/26 19:35,����,��,����,С��,1��
2021/12/27 13:00,��һ,��,����,С��,2��
2021/12/27 14:12,��һ,��,����,С��,2��
2021/12/28 8:04,�ܶ�,��,����,С��,
2021/12/28 11:45,�ܶ�,��,����,С��,1��
2021/12/28 12:40,�ܶ�,��,����,С��,1��
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,
,,,,,`

router.get("/getstream", function (req, res) {
    res.type("text");
    res.write(stream);
    res.end();
})

router.get("/getfile", async function (req, res) {
    res.setHeader('Access-Control-Allow-Origin', '*');
    function read() {
        return new Promise((resolve, rejects) => {
            fs.readFile('./public/word.docx', function (err, data) {
                // 可以更换不同文件 图片 或者 文档 等等 前端接受的时候 对应就ok
                resolve(data)
                rejects(err)
            })
        })
    }
    let data = await read();

    function toArrayBuffer(myBuf) {
        var myBuffer = new ArrayBuffer(myBuf.length);
        var res = new Uint8Array(myBuffer);
        for (var i = 0; i < myBuf.length; ++i) {
            res[i] = myBuf[i];
        }
        return myBuffer;
    }
    data = toArrayBuffer(data);
    console.log("...", data);
    res.send(data);
})



router.get("/readStream", async function (req, res) {
    var s = fs.createReadStream("./server/api/ces.txt");
    var data = ''
    s.setEncoding("utf-8")
    s.on("data", function (txt) {
        data += txt
    })
    s.on("end", function () {
        console.log("文件流式读取成功！", data)
        res.type("text");
        res.write(data);
        res.end();
    })
})

module.exports = router;
